# 12. í”„ë¡œë¯¸ìŠ¤ ê°œë…ë¶€í„° í™œìš©ê¹Œì§€ JavaScript Promise

## Promise <a href="#promise" id="promise"></a>

* JavaScriptì—ì„œ ì œê³µë˜ëŠ” ë¹„ë™ê¸°ë¥¼ ê°„ë‹¨í•˜ê²Œ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” Object
* ì½œë°±í•¨ìˆ˜ ëŒ€ì‹  ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
* Promise ì•ˆì—ì„œëŠ” ë¬´ê±°ìš´ ì¼ì„ ìˆ˜í–‰í•˜ê²Œ ëœë‹¤.
  * ë„¤íŠ¸ì›Œí¬ì—ì„œ ë°ì´í„°ë¥¼ ë°›ì•„ì˜¤ê±°ë‚˜ íŒŒì¼ì—ì„œ í° ë°ì´í„°ë¥¼ ì½ëŠ” ê³¼ì •ì„ ìˆ˜í–‰í•˜ëŠ” ê²ƒì„ ë™ê¸°ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ë©´, ë‹¤ìŒ ì½”ë“œê°€ ì‹¤í–‰ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.
* state
  * ìƒíƒœ
  * processê°€ ë™ì‘ì„ ìˆ˜í–‰ì¤‘ì¸ì§€, ì™„ë£Œë˜ì–´ì„œ ì„±ê³µ ë˜ëŠ” ì‹¤íŒ¨í–ˆëŠ”ì§€
* producer / consumer
  * ì •ë³´ ì œê³µì / ì†Œë¹„ì



```javascript
1. state ìƒíƒœ
pending -> fulfilled or rejected
- pending: operationì„ ìˆ˜í–‰ ì¤‘ ìƒíƒœ
- fulfilled: operationì„ ì™„ë£Œí•˜ê³  ì„±ê³µí•œ ìƒíƒœ
- rejected: operationì„ ì™„ë£Œí–ˆì§€ë§Œ ì‹¤íŒ¨í•œ ìƒíƒœ

2. Producer = class
- newí‚¤ì›Œë“œë¡œ Promise()ê°ì²´ ìƒì„±
- executor : Promiseì˜ ìƒì„±ìì¸ ì½œë°±í•¨ìˆ˜, í•˜ìœ„ì— ë‘ê°œì˜ ì½œë°±í•¨ìˆ˜ë¥¼ ê°€ì§€ê³  ìˆë‹¤.
	- resolve: ê¸°ëŠ¥ì´ ì •ìƒì ìœ¼ë¡œ ìˆ˜í–‰ë˜ì—ˆì„ ë•Œ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ëŠ” ì½œë°±í•¨ìˆ˜
	- reject: ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ë‹¤ê°€ ë¬¸ì œ ë°œìƒì‹œ í˜¸ì¶œë˜ëŠ” ì½œë°±í•¨ìˆ˜

const promise = new Promise((resolve, reject) => {
  // doing some heavy work(networkì—ì„œ ë°ì´í„° ë°›ì•„ì˜¤ê¸°, read files)
  console.log('doing something...');
  
  // New Promiseë¥¼ ë§Œë“œëŠ” ìˆœê°„ executorê°€ ë°”ë¡œ ì‹¤í–‰!!!!!!!!!!!!
  // ë„¤íŠ¸ì›Œí¬ í†µì‹ ì½”ë“œë¥¼ ë„£ì–´ ë†“ì•˜ë‹¤ë©´, Promiseê°€ ë§Œë“¤ì–´ì§€ëŠ” ìˆœê°„ í†µì‹ ì„ ìˆ˜í–‰
  // ë¶ˆí•„ìš”í•œ í†µì‹ ì„ í•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ ì£¼ì˜
  
  setTimeout(() => {
    resolve('ellie');
  }, 2000);
});

3. Consumers(then catch finally)
then, catch, finallyë¥¼ ì´ìš©í•´ì„œ ê°’ì„ ë°›ì•„ì˜¬ ìˆ˜ ìˆë‹¤.
chainingì„ í•  ìˆ˜ ìˆë‹¤.

1) then
- promiseê°€ ì •ìƒì ìœ¼ë¡œ ì˜ ìˆ˜í–‰ì´ë˜ì—ˆì„ ë•Œ
- ê°’ì„ ì „ë‹¬í•˜ê±°ë‚˜ promiseë¥¼ ì „ë‹¬
- ê°™ì€ promiseë¥¼ return

const promise = new Promise((resolve, reject) => {
  // doing some heavy work(network, read files)
  console.log('doing something...');
  setTimeout(() => {
    resolve('siru');
  }, 2000);
});

promise.then((value) => {
  console.log(value);
});

2) catch
- promiseê°€ ìˆ˜í–‰ì¤‘ì— Error ë°œìƒí–ˆì„ ë•Œ
- Error: JavaScriptì—ì„œ ì œê³µí•˜ëŠ” obejct

const promise = new Promise((resolve, reject) => {
  // doing some heavy work(network, read files)
  console.log('doing something...');
  setTimeout(() => {
    reject(new Error('no network'));
  }, 2000);
});

promise
.then((value) => {
  console.log(value);
})
.cath(error => {
  consoel.log(error);
});

3) finally: ìµœê·¼ ì¶”ê°€!
- ì„±ê³µ, ì‹¤íŒ¨ì™€ ê´€ê³„ì—†ì´ ë¬´ì¡°ê±´ ë§ˆì§€ë§‰ì— í˜¸ì¶œ

const promise = new Promise((resolve, reject) => {
  // doing some heavy work(network, read files)
  console.log('doing something...');
  setTimeout(() => {
    reject(new Error('no network'));
  }, 2000);
});

promise
.then((value) => {
  console.log(value);
})
.cath(error => {
  consoel.log(error);
})
.finally(() => {
  console.log('finally');
});

4. Promise chaining
const fetchNumber = new Promise((resolve, reject) => {
  setTimeout(() => resolve(1), 1000);
});

fetchNumber
.then(num => num * 2)
.then(num -> num * 3)
.then(num => {
  return new Promise((resolve, reject) => {
    setTimeout((() => resolve(num - 1), 1000));
  });
})
.then(num => console.log(num));
// thenì€ ê°’ì´ë‚˜ promiseë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆìŒ

5. ì˜¤ë¥˜ ì²˜ë¦¬
const getHen = () =>
    new Promise((resolve, reject) => {
    setTimeout(() => resolve('ğŸ“'), 1000);
  });
const getEgg = hen =>
    new Promise((resolve, reject) => {
    setTimeout(() => reject(new Error(`error! ${hen} => ğŸ¥š`)), 1000);
  });
const cook = egg =>
    new Promise((resolve, reject) => {
    setTimeout(() => resolve(`${egg} => ğŸ³`), 1000);
  });

getHen()
	// ì „ë‹¬ì‹œ ë°›ì•„ì˜¤ëŠ” ê°’ì„ ë‹¤ë¥¸ í•¨ìˆ˜ë¡œ ë°”ë¡œ í•˜ë‚˜ë¥¼ í˜¸ì¶œí•˜ë©´ ìƒëµê°€ëŠ¥
    .then(hen => getEgg(hen)) // â†’ .then(getEgg) 
    .then(Egg => cook(egg))  // â†’ .then(cook) 
    .then(meal => console.log(meal)); //â†’ .then(consloe.log); 

// getEggì—ì„œ ì˜¤ë¥˜ê°€ ë°œìƒí•´ë„ ì ì ˆí•œ ì²˜ë¦¬ë¥¼ í•  ìˆ˜ ìˆë‹¤.
getHen()
    .then(getEgg)
    .catch(error => {
    	return 'ğŸ¥–';
    })
    .then(cook)
    .then(console.log)
    .catch(console.log);
    
6. ì½œë°±í•¨ìˆ˜ ê°œì„ 
const userStorage = new UserStorage();
const id = prompt('enter your id');
const password = prompt('enter toru password');

class UserStorage {
  loginUser(id, password) {
    return new Promise((resolve, reject) => {
            setTimeout(() => {
        if (
          (id === 'jiyun' && password === '1234') ||
          (id === 'ellie' && password === '0000')
        ) {
          resolve(id);
        } else {
          reject(new Error('not found'));
        }
      }, 2000);
    });
  }
  getRoles(user) {
    return new Promise((resolve, reject) => {
            setTimeout(() => {
        if (user === 'eliie') {
          resolve({ name: 'jeliiem', role: 'admin' });
        } else {
          reject(new Error('no access'));
        }
      }, 1000);
    });
  }
}

userStorage
.loginUser(id, password)
.then(userStorage.getRoles)
.then(user => alert( `Hello ${user.name}, you have a ${user.role}`))
.catch(console.log);
```
